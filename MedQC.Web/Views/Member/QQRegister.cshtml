@using MedQC.Web.Models
@{
    ViewBag.Title = "QQRegister";
    Layout = "~/Views/Shared/_Layout.cshtml";
    QQUser qquser = ViewBag.QQUser as QQUser;
}
<hr class="am-article-divider">
<div class="am-g">

    <div class="am-container">
        <div class="am-g am-g-fixed">
            <div class="am-u-md-8">
                <div class="am-tabs" data-am-tabs>
                    <ul class="am-tabs-nav am-nav am-nav-tabs" style="margin-left: 0px;">
                        <li class="am-active"><a href="#tab1">我没有状元乐账号</a></li>
                        <li><a href="#tab2">已经有状元乐账号</a></li>
                    </ul>

                    <div class="am-tabs-bd">
                        <div class="am-tab-panel am-fade am-in am-active" id="tab1">
                            <!-- 注册状元乐账号 start -->
                            <div class="am-panel-group" id="accordion">

                                <div class="am-panel am-panel-secondary">
                                    <div class="am-panel-hd">
                                        <h1 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-2'}">
                                            <i class="am-icon-envelope-o"></i> 快速注册 <small>
                                                此账户尚未绑定状元乐账号，请选择以下方式完成绑定：
                                                绑定成功后，即可快速登录状元乐考试订房服务中心！
                                            </small>
                                        </h1>
                                    </div>
                                    <div id="do-not-say-2" class="am-panel-collapse am-collapse am-in">
                                        <div class="am-panel-bd">
                                            <hr>
                                            <form class="am-form am-form-horizontal" id="form_user" action="/member/qqregister" method="POST">
                                                <input type="hidden" value="@qquser.Gender" name="Gender" />
                                                <input type="hidden" value="@qquser.ID" name="QQUserID" />
                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">用户账号</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-primary">
                                                            <span class="am-input-group-label"><i class="am-icon-envelope-o am-icon-user"></i></span>
                                                            <input type="text" class="am-form-field" name="username" value="@qquser.NickName" id="f_name" minlength="2" maxlength="10" placeholder="账号" required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">
                                                        <small>输入你的名字，让我们记住你。</small>
                                                    </div>
                                                </div>
                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">手机号</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-primary">
                                                            <span class="am-input-group-label"><i class="am-icon-envelope-o am-icon-mobile"></i></span>
                                                            <input type="number" class="am-form-field" name="tel" id="f_tel" minlength="11" maxlength="11" placeholder="手机号" required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">
                                                        <small>输入你的手机号。</small>
                                                    </div>
                                                </div>
                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">电子邮件 / Email</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-primary">
                                                            <span class="am-input-group-label"><i class="am-icon-envelope-o am-icon-fw"></i></span>
                                                            <input type="email" class="am-form-field" name="mail" id="f_email" placeholder="邮箱 " required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">
                                                        <small>输入你常用的邮箱。</small>
                                                    </div>
                                                </div>

                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">密码</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-warning">
                                                            <span class="am-input-group-label"><i class="am-icon-key am-icon-fw"></i></span>
                                                            <input type="password" class="am-form-field" name="password" id="f_pwd" placeholder="密码" required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">
                                                        <small>最小值为6位（字母区分大小写）</small>
                                                    </div>
                                                </div>

                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">确认密码</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-warning">
                                                            <span class="am-input-group-label"><i class="am-icon-key am-icon-fw"></i></span>
                                                            <input type="password" name="password2" id="f_pwd2" class="am-form-field" placeholder="确认密码 " required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">
                                                        <small></small>
                                                    </div>
                                                </div>

                                                <div class="am-form-group">
                                                    <div class="am-u-sm-6 am-u-sm-push-3">
                                                        <div id="error_msg" style="color: #c00;display:none;">正在审核，请您耐心等待...</div>

                                                        <button id="forum-user-reg" type="submit" name="sub" class="am-btn am-btn-primary am-btn-block btn-loading-example" data-am-loading="{spinner: 'circle-o-notch', loadingText: '加载中...'}">注册个账号</button>
                                                    </div>
                                                </div>
                                            </form>

                                            <script type="text/javascript">
                                                var $btn = $('#forum-user-reg');
                                                var pwd = "";
                                                var pwd2 = "";
                                                $('#form_user').bind('form-pre-serialize', function (event, form, options, veto) {
                                                    pwd = $('#f_pwd').val();
                                                    pwd2 = $('#f_pwd2').val();
                                                    $('#f_pwd').val($('#f_pwd').val());
                                                    $('#f_pwd2').val($('#f_pwd2').val());
                                                });
                                                $('#form_user').ajaxForm({
                                                    beforeSubmit: function (a, f, o) {
                                                        if ($('#f_email').val().length == 0) {
                                                            $('#f_pwd').val(pwd);
                                                            $('#f_pwd2').val(pwd2);
                                                            $('#f_email').focus();
                                                            $('#error_msg').html(" 邮箱地址必须填写");
                                                            $('#error_msg').show();
                                                            return false;
                                                        }
                                                        if ($('#f_name').val().length < 2) {
                                                            $('#f_name').focus();
                                                            $('#error_msg').html(" 账号必须填写,请填写2~10个字符串！");
                                                            $('#error_msg').show("fast");
                                                            $('#f_pwd').val(pwd);
                                                            $('#f_pwd2').val(pwd2);
                                                            return false;
                                                        }
                                                        if (pwd.length < 6 || $('#f_pwd').val() != $('#f_pwd2').val()) {
                                                            $('#f_pwd').val(pwd);
                                                            $('#f_pwd2').val(pwd2);
                                                            $('#f_pwd').focus();
                                                            $('#error_msg').html(" 两次密码必须填写，且要匹配 (最少6位)");
                                                            $('#error_msg').show();
                                                            return false;
                                                        }

                                                        $('#error_msg').html(" 正在审核，请您耐心等待...");
                                                        $('#error_msg').show();
                                                        $btn.button('loading');
                                                    },
                                                    success: function (html) {
                                                        if (html.length > 0) {
                                                            $('#f_pwd').val(pwd);
                                                            $('#f_pwd2').val(pwd2);
                                                            $('#error_msg').hide();
                                                            $('#error_msg').html(html);
                                                            $('#error_msg').show();
                                                            $btn.button('reset');
                                                        } else {
                                                            $btn.button('reset');
                                                            //location.href = "http://www.tngou.net/reg/sendmail?email=" + $('#f_email').val() + "&type=activate";
                                                            location.href = "/";
                                                        }
                                                    }
                                                });
                                            </script>



                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- 注册状元乐账号 end -->
                        </div>
                        <div class="am-tab-panel am-fade" id="tab2">
                            <!-- 绑定已有状元乐账号 start -->
                            <div class="am-panel-group" id="accordion">

                                <div class="am-panel am-panel-secondary">
                                    <div class="am-panel-hd">
                                        <h1 class="am-panel-title" data-am-collapse="{parent: '#accordion', target: '#do-not-say-2'}">
                                            <i class="am-icon-envelope-o"></i> 绑定已有账号 <small>
                                                绑定成功后，即可快速登录状元乐考试订房服务中心！
                                            </small>
                                        </h1>
                                    </div>
                                    <div id="do-not-say-2" class="am-panel-collapse am-collapse am-in">
                                        <div class="am-panel-bd">
                                            <hr>
                                            <form class="am-form am-form-horizontal" id="form_bind" action="/member/qqbind" method="POST">
                                                <input type="hidden" value="@qquser.ID" name="QQUserID" />
                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">邮箱 /账号 /手机:</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-primary">
                                                            <span class="am-input-group-label"><i class="am-icon-envelope-o am-icon-user"></i></span>
                                                            <input type="text" class="am-form-field" name="username" id="f2_name" placeholder="账号" required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">

                                                    </div>
                                                </div>

                                                <div class="am-form-group">
                                                    <label for="user-email" class="am-u-md-3 am-form-label">密码</label>
                                                    <div class="am-u-md-6">
                                                        <div class="am-input-group  am-input-group-warning">
                                                            <span class="am-input-group-label"><i class="am-icon-key am-icon-fw"></i></span>
                                                            <input type="password" class="am-form-field" name="password" id="f2_pwd" placeholder="密码" required="">
                                                        </div>

                                                    </div>
                                                    <div class="am-u-md-3">
                                                        <small></small>
                                                    </div>
                                                </div>


                                                <div class="am-form-group">
                                                    <div class="am-u-sm-6 am-u-sm-push-3">
                                                        <div id="error2_msg" style="color: #c00;display:none;">正在审核，请您耐心等待...</div>

                                                        <button id="forum-user-bind" type="submit" name="sub" class="am-btn am-btn-primary am-btn-block btn-loading-example" data-am-loading="{spinner: 'circle-o-notch', loadingText: '加载中...'}">完成绑定</button>
                                                    </div>
                                                </div>
                                            </form>

                                            <script type="text/javascript">
                                                var $btn = $('#forum-user-bind');
                                                var pwd = "";
                                                var pwd2 = "";
                                                $('#form_bind').bind('form-pre-serialize', function (event, form, options, veto) {
                                                    pwd = $('#f2_pwd').val();

                                                });
                                                $('#form_bind').ajaxForm({
                                                    beforeSubmit: function (a, f, o) {
                                                        if ($('#f2_name').val().length == 0) {
                                                            $('#f_pwd').val(pwd);
                                                            $('#f2_name').focus();
                                                            $('#error2_msg').html("请输入登录的邮箱或者帐号或者手机号");
                                                            $('#error2_msg').show();
                                                            return false;
                                                        }
                                                        if (pwd.length == 0) {
                                                            $('#f2_pwd').val(pwd);
                                                            $('#f2_pwd').focus();
                                                            $('#error2_msg').html("请输入登录密码");
                                                            $('#error2_msg').show();
                                                            return false;
                                                        }
                                                        $('#error2_msg').html("正在验证，请您耐心等待...");
                                                        $('#error2_msg').show();
                                                        $btn.button('loading');
                                                    },
                                                    success: function (html) {
                                                        if (html.length > 0) {
                                                            $('#error2_msg').hide();
                                                            $('#error2_msg').html(html);
                                                            $('#error2_msg').show();
                                                            $('#f2_pwd').val(pwd);
                                                            $btn.button('reset');
                                                        } else {
                                                            setTimeout(function () {
                                                                location.href = "/";
                                                                $btn.button('reset');
                                                            }, 1000)
                                                        }
                                                    }
                                                });
                                            </script>



                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- 绑定已有状元乐账号 end -->
                        </div>

                    </div>



                </div>
            </div>
            <div class="am-u-md-4" id="my-side">
                @Html.Partial("sidebox")
            </div>
        </div>
    </div>
</div>
